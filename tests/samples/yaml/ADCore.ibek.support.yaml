# yaml-language-server: $schema=../schemas/ibek.defs.schema.json

module: ADCore

defs:
  - name: NDRoi
    description: Defines a ROI Plugin for an AreaDetector instance
    args:
      - type: id
        name: PORT
        description: Port for this plugin

      - type: object
        name: NDARRAY_PORT
        description: Port Name for input NDArray plugin

      - type: str
        name: P
        description: The PV prefix

      - type: str
        name: R
        description: The PV suffix

      - type: int
        name: TIMEOUT
        description: Timeout for ASYN communications
        default: 1

      - type: int
        name: ADDR
        description: ASYN Address this plugin
        default: 0

      - type: int
        name: NDARRAY_ADDR
        description: ASYN Address for input NDArray plugin
        default: 0

      - type: bool
        name: ENABLED
        description: Enable/Disable this plugin at startup
        default: true

      - type: str
        name: SCANRATE
        description: Epics record scan rate
        default: I/O Intr

      - type: int
        name: QUEUE
        description: Number of NDArray buffers to be created for plugin callbacks
        default: 2

      - type: bool
        name: BLOCK
        description: blocking callbacks?
        default: false

      - type: int
        name: MAX_THREADS
        description: Maximum number of threads to use
        default: 1

    script:
      - type: function
        name: NDROIConfigure
        args:
          AsynPortName: "{{ PORT }}"
          QueueSize: "{{ QUEUE }}"
          BlockingCallbacks: "{{ BLOCK | int }}"
          NDArrayPort: "{{ NDARRAY_PORT }}"
          NDArrayAddr: "{{ NDARRAY_ADDR }}"
          MaxBuffers: 0
          MaxMemory: 0
          Priority: 0
          StackSize: 0
          MaxThreads: "{{ MAX_THREADS }}"

    databases:
      - file: NDROI.template
        args:
          {
            P,
            R: "{{ R }}:{{ REPEAT }}",
            PORT,
            TIMEOUT,
            ADDR,
            NDARRAY_PORT,
            NDARRAY_ADDR,
            ENABLED: "{{ ENABLED | int }}",
            SCANRATE,
          }

  - name: NDStats
    description: Defines a Stats Plugin for an AreaDetector instance
    args:
      - type: id
        name: PORT
        description: Port for this plugin

      - type: str
        name: NDARRAY_PORT
        description: Port Name for input NDArray plugin

      - type: str
        name: P
        description: The PV prefix

      - type: str
        name: R
        description: The PV suffix

      - type: int
        name: TIMEOUT
        description: Timeout for ASYN communications
        default: 1

      - type: int
        name: ADDR
        description: ASYN Address this plugin
        default: 0

      - type: int
        name: NDARRAY_ADDR
        description: ASYN Address for input NDArray plugin
        default: 0

      - type: bool
        name: ENABLED
        description: Enable/Disable this plugin at startup
        default: true

      - type: str
        name: SCANRATE
        description: Epics record scan rate
        default: I/O Intr

      - type: int
        name: QUEUE
        description: Number of NDArray buffers to be created for plugin callbacks
        default: 2

      - type: bool
        name: BLOCK
        description: blocking callbacks?
        default: false

      - type: int
        name: MAX_THREADS
        description: Maximum number of threads to use
        default: 1

    script:
      - type: function
        name: NDStatsConfigure
        args:
          {
            A,
            B,
            C: "{{ xxx }}",
            D,
            E: "{{ yyy }}",
            G: "{{ yyy }}",
            F: "{{ zzz }}",
          }

    databases:
      - file: NDStats.template
        args:
          {
            P,
            R,
            PORT,
            TIMEOUT,
            ADDR,
            NDARRAY_PORT,
            NDARRAY_ADDR,
            ENABLED: "{{ ENABLED | int }}",
            SCANRATE,
          }
        define_args: |
